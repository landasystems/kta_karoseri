<div ng-app="app" ng-controller="poCtrl">
    <div class="bg-light lter b-b wrapper-md">
        <h1 class="m-n font-thin h3">Purchase Order</h1>
    </div>
    <div class="wrapper-md" ng-show="!is_edit">
        <div class="panel panel-default" st-pipe="callServer" st-table="displayed">
            <div class="panel-heading">
                <button class="btn btn-default btn-xs" ng-init="isCollapsed = true" ng-click="isCollapsed = !isCollapsed">Pencarian</button>
                <div class="btn-group pull-right" role="group" style="margin-top: -3px;">
                    <button type="button" class="btn btn-info fa fa-lock" ng-click="lock(gantiStatus);" ng-show="status == 0 && user.roles_id == 1">&nbsp;Lock</button>
                    <button type="button" class="btn btn-success fa fa-unlock" ng-click="unlock(gantiStatus);" ng-show="status == 1 && user.roles_id == 1">&nbsp;Unlock</button>
                    <button type="button" class="btn btn-warning fa fa-print" ng-show="user.roles_id == '1'" ng-click="bukaPrint(gantiStatus)">&nbsp;Buka Print Out</button>
                    <button type="button" class="btn btn-primary fa fa-plus-square-o" ng-click="create();">&nbsp;Tambah Data</button>
                </div> 
            </div>
            <div collapse="isCollapsed" class="panel-body collapse" style="height: 0px;">
                <div class="form-horizontal">
                    <div class="col-md-6">
                        <div class="form-group">
                            <label class="col-sm-4 control-label">No. PO</label>
                            <div class="col-sm-8">
                                <input st-search="trans_po.nota" class="form-control"/>
                            </div>
                        </div>
                        <div class="form-group">
                            <label class="col-sm-4 control-label">No.SPP</label>
                            <div class="col-sm-8">
                                <input st-search="trans_po.spp" class="form-control"/>
                            </div>
                        </div>
                        <div class="form-group" ng-show="user.roles_id == 1">
                            <label class="col-sm-4 control-label">Status</label>
                            <div class="col-sm-8">
                                <select stInputEvent="change" st-search="trans_po.lock" class="form-control" ng-model="status">
                                    <option value="">.: Pilih Status :.</option>
                                    <option value="1">Lock</option>
                                    <option value="0">Unlock</option>
                                </select>
                            </div>
                        </div>
                    </div>
                    <div class="col-md-6">
                        <div class="form-group">
                            <label class="col-sm-4 control-label">Supplier</label>
                            <div class="col-sm-8">
                                <input st-search="supplier.nama_supplier" class="form-control"/>
                            </div>
                        </div>
                        <div class="form-group">
                            <label class="col-sm-4 control-label">Nama Barang</label>
                            <div class="col-sm-8">
                                <input st-search="nm_barang" class="form-control"/>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
            <div class="table-responsive">
                <table class="table table-striped table-hover" >
                    <thead>
                        <tr>
                            <th ng-show="user.roles_id == '1'">&nbsp;#</th>
                            <th st-sort="nota">Nomor Po</th>
                            <th st-sort="spp">No SPP</th>
                            <th st-sort="tanggal">tanggal</th>
                            <th st-sort="dikirim_ke">Tujuan Pengiriman</th>
                            <th style="text-align:right;" ng-hide="is_view == true">Action &nbsp;</th>
                        </tr>
                    </thead>
                    <tbody ng-show="!isLoading">
                        <tr ng-repeat="row in displayed" ng-dblclick="view(row)">
                            <td ng-show="user.roles_id == '1'">
                                <label class="i-checks">
                                    <input type="checkbox" ng-model="gantiStatus[row.nota]" ><i></i> 
                                </label>
                            </td>
                            <td>{{row.nota}}</td>
                            <td>{{row.spp}}</td>
                            <td>{{row.tanggal| date}}</td>
                            <td>{{row.dikirim_ke}}</td>
                            <td>
                                <div ng-show="row.lock == 0 || user.roles_id == 1" class="btn-group pull-right"  role="group" style="margin-top: -3px;">
                                    <button type="button" class="btn btn-info fa fa-edit" ng-click="update(row)"></button>
                                    <button type="button" class="btn btn-danger fa fa-minus-circle" ng-click="delete(row);" ></button>
                                </div> 
                            </td>
                        </tr>
                    </tbody>
                    <tbody ng-show="isLoading">
                        <tr>
                            <td colspan="6" class="text-center" ng-if="user.roles_id == 1">Loading ... </td>
                            <td colspan="5" class="text-center" ng-if="user.roles_id != 1">Loading ... </td>
                        </tr>
                    </tbody>
                    <tfoot>
                        <tr>
                            <td colspan="5" ng-if="user.roles_id != 1" class="text-center" st-pagination="" st-items-by-page="10" st-template="tpl/blocks/pagination.custom.html"></td>
                            <td colspan="6" ng-if="user.roles_id == 1" class="text-center" st-pagination="" st-items-by-page="10" st-template="tpl/blocks/pagination.custom.html"></td>
                        </tr>
                </table>		
            </div>
        </div>
    </div>

    <!--FORM-->

    <div class="wrapper-md" ng-show="is_edit">
        <div class="panel panel-default">
            <div class="panel-heading">
                {{formtitle}}
                <div class="btn-group pull-right" role="group" style="margin-top: -3px;" ng-hide="is_print == false">
                    <button type="button" class="btn btn-primary fa fa-print" ng-click="updt_st(form.nota)" ng-print print-element-id="printArea" ng-disabled="form.status == '1' && user.roles_id != '1'">&nbsp;Print</button>
                </div> 
            </div>
            <div class="panel-body">
                <div class="alert alert-danger" ng-hide="is_print == false" ng-if="msg.length > 0">
                    <p>{{msg}}</p>
                </div>
                <form name="landaform" class="form-horizontal form-validation ">
                    <div class="row">
                        <div class="col-md-12 col-sm-12">
                            <div class="col-md-6 col-sm-12">
                                <div class="form-group">
                                    <label class="col-sm-3 control-label">Nomor PO</label>
                                    <div class="col-sm-6">
                                        <input type="text" class="form-control" ng-model="form.nota" ng-disabled="true" ng-readonly="is_create == false"/>
                                    </div>
                                </div>
                                <div class="form-group">
                                    <label class="col-sm-3 control-label">Tanggal</label>
                                    <div class="col-sm-6">
                                        <div class="input-group">
                                            <input type="text" class="form-control" datepicker-popup="dd-MM-yyyy" ng-disabled="is_view" ng-model="form.tanggal" is-open="opened1" ng-click="open1($event)"/>
                                            <span class="input-group-addon">
                                                <i class="glyphicon glyphicon-calendar"></i>
                                            </span>
                                        </div>
                                    </div>
                                </div>
                                <div class="form-group">
                                    <label class="col-sm-3 control-label">Pilihan</label>
                                    <div class="col-sm-6">
                                        <div class="btn-group">
                                            <label class="btn btn-default"  ng-model="form.status_po" btn-radio="'1'"  required> PO Produksi</label>
                                            <label class="btn btn-default"  ng-model="form.status_po" btn-radio="'0'"  required> PO Non Produksi</label>
                                        </div>
                                    </div>
                                </div>
                                <div class="form-group" ng-hide="form.status_po == 0">
                                    <label class="col-sm-3 control-label">No. SPP</label>
                                    <div class="col-sm-6">
                                        <div class="input-group">
                                            <ui-select on-select="cariBarang('',form.listspp.no_spp)"  ng-model="form.listspp" ng-readonly="form.status_po == '0'" theme="bootstrap">
                                                <ui-select-match>{{$select.selected.no_spp}} - {{$select.selected.no_proyek}}</ui-select-match>
                                                <ui-select-choices refresh="cariSpp($select.search)" repeat="val in resultsspp">
                                                    {{val.no_spp}} - {{val.no_proyek}}
                                                </ui-select-choices>
                                            </ui-select>
                                            <span class="input-group-btn">
                                                <button ng-click="form.listspp = undefined" class="btn btn-default">
                                                    <span class="glyphicon glyphicon-trash"></span>
                                                </button>
                                            </span>
                                        </div>
                                    </div>
                                </div>
                            </div>
                            <div class="col-md-6 col-sm-12">
                                <div class="form-group">
                                    <label class="col-sm-3 control-label">&nbsp;Kepada Yth</label>
                                    <div class="col-sm-6">
                                        <div class="input-group">
                                            <ui-select  ng-model="form.supplier" theme="bootstrap">
                                                <ui-select-match>{{$select.selected.nama_supplier}}</ui-select-match>
                                                <ui-select-choices refresh="cariSuppiler($select.search)" repeat="val in resultssupplier">
                                                    {{val.nama_supplier}}
                                                </ui-select-choices>
                                            </ui-select>
                                            <span class="input-group-btn">
                                                <button ng-click="form.supplier = undefined" class="btn btn-default">
                                                    <span class="glyphicon glyphicon-trash"></span>
                                                </button>
                                            </span>
                                        </div>
                                    </div>
                                </div>
                                <div class="form-group">
                                    <label class="col-sm-3 control-label">Jatuh Tempo</label>
                                    <div class="col-sm-6">
                                        <div class="input-group m-b" style="margin:0px;">
                                            <input type="text" class="form-control" ng-model="form.jatuh_tempo" ng-disabled="is_view" required/>
                                            <span class="input-group-addon">/ Hari</span>
                                        </div>
                                    </div>
                                </div>
                                <div class="form-group">
                                    <label class="col-sm-3 control-label">Dikirim Ke</label>
                                    <div class="col-sm-6">
                                        <input type="text" class="form-control" ng-model="form.dikirim_ke" ng-disabled="is_view" required/>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                    <div class="row" style="margin-top: 20px;">
                        <div class="col-sm-12 col-sm-12">
                            <table class="table table-striped b-t b-light">
                                <thead>
                                    <tr>
                                        <th class="panel-heading text-muted font-bold" colspan="7">Detail Purchase Order</th>
                                        <th class="panel-heading text-muted font-bold" ng-hide="is_view == true"><button ng-click="addDetail()" title="Tambah Data" class="btn btn-success" ng-disabled="is_view"><i class="fa fa-plus"></i></button></th>
                                    </tr>
                                    <tr>
                                        <th style="text-align: center;">Nama Barang</th>
                                        <th style="text-align: center;">QTY</th>
                                        <th style="text-align: center;">Satuan</th>
                                        <th style="text-align: center;">Harga</th>
                                        <th style="text-align: center;">Jumlah</th>
                                        <th style="text-align: center;">Tgl Pengiriman</th>
                                        <th style="text-align: center;">Keterangan</th>
                                        <th style="margin:0px;padding:0px;" ng-hide="is_view == true"></th>
                                    </tr>
                                </thead>
                                <tbody>
                                    <tr ng-repeat="detail in detsPo">
                                        <td>
                                            <div class="input-group">
                                                <ui-select on-select="pilih(detail, $item)" ng-model="detail.data_barang" theme="bootstrap">
                                                    <ui-select-match>{{$select.selected.nm_barang}}</ui-select-match>
                                                    <ui-select-choices refresh="cariBarang($select.search,form.listspp.no_spp)" repeat="val in resultsbrg">
                                                        {{val.nm_barang}}
                                                    </ui-select-choices>
                                                </ui-select>
                                                <span class="input-group-btn">
                                                    <button ng-click="detail.kode_barang = undefined" class="btn btn-default">
                                                        <span class="glyphicon glyphicon-trash"></span>
                                                    </button>
                                                </span>
                                                <!--<input type="text" class="form-control" ng-model="detail.data_barang.nm_barang" ng-disabled="is_view" ng-readonly="true">-->
                                            </div>
                                        </td>
                                        <td>
                                            <input style="width:70px;" type="text" class="form-control" ng-model="detail.jml" ng-change="subtotal()" ng-disabled="is_view" ng-readonly="is_edit == false" required>
                                        </td>
                                        <td> 
                                            <input type="text" class="form-control" ng-model="detail.data_barang.satuan" ng-disabled="is_view" ng-readonly="true">
                                        </td>
                                        <td>
                                            <div class="input-group" style="margin:0px;">
                                                <span class="input-group-addon">Rp</span>
                                                <input type="text" class="form-control" ng-maxlength="15" ng-pattern="/^[0-9]+$/" ng-change="subtotal()"  ng-model="detail.harga" ng-disabled="is_view" ng-readonly="is_edit == false">
                                            </div>
                                        </td>
                                        <td style="width:180px;">
                                            <div class="input-group" style="margin:0px;">
                                                <span class="input-group-addon">Rp</span>
                                                <input type="text" class="form-control" ng-maxlength="15" ng-pattern="/^[0-9]+$/" ng-change="subtotal()"  ng-model="detail.jumlah" ng-disabled="is_view" ng-readonly="true">
                                            </div>
                                        </td>
                                        <td style="width:200px;">
                                            <div class="input-group">
                                                <input type="text" class="form-control" datepicker-popup="dd-MM-yyyy" ng-disabled="is_view" ng-model="detail.data_barang.tgl_pengiriman" is-open="openedDet == $index" ng-change="setStatus()" ng-click="openDet($event, $index)"/>
                                                <span class="input-group-addon">
                                                    <i class="glyphicon glyphicon-calendar"></i>
                                                </span>
                                            </div>
                                        </td>
                                        <td style="width:200px;">
                                            <input type="text" class="form-control"   ng-model="detail.ket" ng-disabled="is_view" ng-readonly="is_edit == false">
                                        </td>
                                        <td ng-hide="is_view == true" style="width:50px;text-align: center;">
                                            <button ng-click="removeRow($index)" title="Hapus Data" class="btn btn-danger"  ng-disabled="is_view"><i class="fa fa-trash-o"></i></button>
                                        </td>
                                    </tr>
                                </tbody>
                            </table>
                        </div>
                    </div>
                    <br>
                    <div class="col-md-4 col-sm-12">
                        <div class="panel panel-info" style="text-align: center">
                            <div class="form-group">
                                <div class="col-sm-12">
                                    <div class="panel-heading text-muted font-bold">

                                        Jenis Pembayaran

                                    </div>
                                </div>
                            </div>
                            <div class="form-group">
                                <div class="col-sm-12">
                                    <div class="btn-group" style="position: center;">
                                        <label style="padding:5px 73px;" class="btn btn-default"  ng-model="form.bayar"  btn-radio="'0'"> Tunai</label>
                                        <label style="padding:5px 73px;" class="btn btn-default" ng-model="form.bayar" btn-radio="'1'"> Kredit</label>
                                    </div>
                                </div>
                            </div>

                        </div>
                    </div>
                    <div class="col-md-3 col-sm-12">
                    </div>
                    <div class="col-md-5 col-sm-12">
                        <div class="panel panel-info" style="text-align: center">
                            <div class="form-group">
                                <div class="col-sm-12">
                                    <div class="panel-heading text-muted font-bold">

                                        Total

                                    </div>
                                </div>
                            </div>
                            <div class="form-group" >
                                <label class="col-sm-6 control-label" style="text-align: left; margin-left: 10px">Total Pembayaran</label>
                                <div class="col-sm-5">
                                    <div class="input-group" style="margin:0px;">
                                        <span class="input-group-addon">Rp</span>
                                        <input type="text" class="form-control" ng-model="form.total" ng-disabled="is_view" ng-readonly="true" >
                                    </div>
                                </div>
                            </div>
                            <div class="form-group">
                                <label class="col-sm-3 control-label" style="text-align: left; margin-left: 10px">Diskon</label>

                                <div class="col-sm-3">
                                    <div class="input-group m-b" style="margin:0px;">
                                        <input type="text" class="form-control" ng-change="subtotal()"  ng-model="form.nilai_diskon" ng-disabled="is_view">
                                        <span class="input-group-addon">%</span>
                                    </div>

                                </div>
                                <div class="col-sm-5">
                                    <div class="input-group" style="margin:0px;">
                                        <span class="input-group-addon">Rp</span>
                                        <input type="text" class="form-control"  ng-model="form.diskon" ng-disabled="true" >
                                    </div>
                                </div>

                            </div>
                            <div class="form-group">
                                <label class="col-sm-3 control-label" style="text-align: left; margin-left: 10px">PPN 10 %</label>
                                <div class="col-sm-3">
                                    <select ng-model="form.status_ppn"  class="form-control"  required ng-change="subtotal()">
                                        <option  value="0">Include</option>
                                        <option value="1">Exclude</option>
                                    </select>

                                </div>
                                <div class="col-sm-5">
                                    <div class="input-group" style="margin:0px;">
                                        <span class="input-group-addon">Rp</span>
                                        <input type="text" class="form-control" ng-change="subtotal()" ng-readonly="form.status_ppn == '1'" ng-model="form.ppn" ng-disabled="is_view" required >
                                    </div>
                                </div>

                            </div>
                            <div class="form-group">
                                <label class="col-sm-6 control-label" style="text-align: left; margin-left: 10px">&nbsp;Total Dibayar</label>
                                <div class="col-sm-5">
                                    <div class="input-group" style="margin:0px;">
                                        <span class="input-group-addon">Rp</span>
                                        <input type="text" class="form-control" ng-pattern="/^[0-9]+$/" ng-change="subtotal()" ng-model="form.total_dibayar" ng-disabled="is_view" required >
                                    </div>
                                </div>
                            </div>

                            <div class="form-group">
                                <label class="col-sm-6 control-label" style="text-align: left; margin-left: 10px">&nbsp;DP</label>
                                <div class="col-sm-5">
                                    <div class="input-group" style="margin:0px;">
                                        <span class="input-group-addon">Rp</span>
                                        <input type="text" class="form-control" ng-pattern="/^[0-9]+$/" ng-change="subtotal()" ng-model="form.dp" ng-disabled="is_view" required >
                                    </div>
                                </div>
                            </div>
                            <div class="form-group">
                                <label class="col-sm-6 control-label" style="text-align: left; margin-left: 10px">&nbsp;Sisa Bayar</label>
                                <div class="col-sm-5">
                                    <div class="input-group" style="margin:0px;">
                                        <span class="input-group-addon">Rp</span>
                                        <input type="text" class="form-control" ng-pattern="/^[0-9]+$/" ng-change="subtotal()" ng-model="form.sisa_dibayar" ng-disabled="is_view" >
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                    <div class="line line-dashed b-b line-lg pull-in"></div>
                    <div class="form-group" style="text-align: center">
                        <div class="col-sm-8 col-sm-offset-2">
                            <button type="submit" class="btn btn-default fa fa-arrow-circle-o-left" ng-click="cancel()">&nbsp;Back</button>
                            <button type="submit" class="btn btn-primary fa fa-save" ng-hide="is_view" ng-disabled="landaform.$invalid" ng-click="save(form, detsPo)">&nbsp;Simpan</button>
                        </div>
                    </div>	
                </form>
            </div>
        </div>
    </div>


    <!--PRINT-->

    <div id="printArea" ng-show="is_view">
        <table class="table_po" style="border-collapse: collapse;font-size: 12px;">
            <thead>
                <tr>
                    <td colspan="6" style="border-right:0px;padding: 10px" >
                        <div style="border:1px solid #000;padding:5px ;border-collapse: collapse;">
                            <div>
                                <img ng-src="img/logo.png" align="left" style="margin-right: 8px"/>
                            </div>
                            <div>
                                <center>
                                    <h2>PURCHASE / WORK ORDER</h2>
                                    No. Dokumen : FR - PCH - 003
                                </center>
                            </div>
                        </div>
                    </td>
                </tr>
                <tr>
                    <td colspan="6" style="border-right: 0px; border-left: 0px; border-right:0px">
                        <div>
                            <div class="kiri">
                                <div>Tanggal  : {{form.tanggal| date:'dd MMMM yyyy'}}</div>
                                <div>Nomor : {{form.nota}}</div>
                                <div>Spp No. : {{form.spp}}</div>
                            </div>
                            <div class="kanan" style="text-align:left;">
                                <div>Kepada Yth. : {{form.supplier.nama_supplier}}</div>
                            </div>
                        </div>
                    </td>
                </tr>
            </thead>


            <tbody  width="700">
                <tr class="table_po tr">
                    <th style="text-align: center;width: 5%">No.</th>
                    <th style="width:200px;">URAIAN</th>
                    <th style="text-align: center;width:5%">KWANTUM</th>
                    <th style="text-align: center;width:6%">SATUAN</th>
                    <th style="text-align: center;">HARGA</th>
                    <th style="text-align: center;">JUMLAH</th>
                </tr>
                <tr class="table_po tr" ng-repeat="detail in detsPo">
                    <td style="text-align:center;">{{detail.data_barang.no}}</td>
                    <td>{{detail.data_barang.nm_barang}} - {{detail.ket}}</td>
                    <td style="text-align:center;">{{detail.jml}}</td>
                    <td style="text-align:center;">{{detail.data_barang.satuan}}</td>
                    <td style="text-align:right;" width="19%">{{detail.harga| number}}</td>
                    <td style=" text-align: right;  " width="19%">{{detail.jumlah| number}}</td>
                </tr>


                <tr style="border-bottom:0px">
                    <td colspan="3">
                        Keterangan :
                        <div>- Jatuh Tempo &nbsp;&nbsp;:&nbsp; {{form.jatuh_tempo}} hari</div> 
                        <div>- Dikirim ke &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;: {{form.dikirim_ke}}</div>
                        <div>- Pengiriman Tanggal : {{form.tanggal| date:'dd-MMMM-yyyy'}}</div>
                        <div>- Form asli ini berlaku untuk penagihan</div>
                        <div>- Spesifikasi teknis terlampir</div>
                        <table class="tablepo" style="width:101% ;margin-left: -2px;margin-bottom: -2px;border-collapse: collapse;font-size: 12px;">
                            <tr style="border-top:  1px solid #333;">
                                <td style=" text-align:center;border-top:  1px solid #333;border-left:none;">Pemberi Order</td>
                                <td style=" text-align:center;border-top:  1px solid #333;">Penerima Order</td>
                            </tr>
                            <tr height="80">
                                <td style="border-left:  none;"></td>
                                <td></td>
                            </tr>
                            <tr>
                                <td style="border-left:none;border-bottom: none;">Tgl :</td>
                                <td style="border-bottom: none;">Tgl :</td>
                            </tr>
                        </table>
                    </td>
                    <td colspan="3" rowspan="3" style="border-right:none;" valign="top">
                        <div>
                            <div class="kiri">
                                <div>Total pembelian / biaya </div>
                                <div>Diskon</div>
                                <div>Dasar pengenaan pajak</div>
                                <div>PPN 10%</div>
                                <div>Total yang harus dibayar</div>
                                <div>Uang muka</div>
                                <div>Sisa yang harus dibayar</div>
                                <div>Terbilang</div>

                            </div>
                            <div class="kanan">
                                <div>{{form.total|  currency:undefined:0}}</div>
                                <div>{{form.nilai_diskon| currency:undefined:0 }}</div>
                                <div>Rp. </div>
                                <div>{{form.ppn| currency:undefined:0}}</div>
                                <div>{{form.total_dibayar| currency:undefined:0}}</div>
                                <div>{{form.dp| currency:undefined:0 }}</div>
                                <div>{{form.sisa_dibayar| currency:undefined:0}}</div>
                                <div> </div>
                            </div>
                        </div>
                        <div>
                            <div class="kiri" style="margin-left: 3px;">
                                {{form.terbilang| uppercase}}
                            </div>
                        </div>
                    </td>
                </tr>
            </tbody>
        </table>
    </div>

</div>
